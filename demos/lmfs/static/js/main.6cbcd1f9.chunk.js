(this["webpackJsonpdune-buggy"]=this["webpackJsonpdune-buggy"]||[]).push([[0],{151:function(e,t,a){"use strict";a.r(t);var o,n,i,s,r,l,c,u,g,d,h,p,m,f,v=a(7),w=a.n(v),y=a(21),b=a(4),j=a(5),L=a(58),O=a(57),S=a(0),D=a.n(S),k=a(22),T=a(1),C=a.n(T),x=a(19),P=a(6),M=a(23),E=a.n(M),R=function(e){var t=window.location.protocol+"//"+window.location.host+window.location.pathname+e;window.history.pushState({path:t},"",t)},_=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location.search,a=E.a.parse(t);return a[e]},I=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window.location.search,o=E.a.parse(a),n=E.a.stringify(Object(P.a)(Object(P.a)({},o),{},Object(x.a)({},e,t)));R("?".concat(n))},F=a(2),V=new Promise((function(e){o=e})),A=[],H=[],U=[],J={},N={},q=function(e){return e===k.Status.LOADING?Object(F.jsxs)("h3",{children:[e," .."]}):e===k.Status.FAILURE?Object(F.jsxs)("h3",{children:[e," ..."]}):null};function W(e){C.a.forEach(A,(function(e){return e.setMap(null)})),A=[],C.a.forEach(H,(function(e){return e.setMap(null)})),H=[];var t,a=p.getTrips(),o=new window.google.maps.LatLngBounds;if(C.a.forEach(a,(function(a){var s,r=a.getPathCoords(n,i);if(r.length>0){t=C.a.last(r);var l=new window.google.maps.Polyline({path:r,geodesic:!0,strokeColor:G(a.tripIdx),strokeOpacity:.5,strokeWeight:6});google.maps.event.addListener(l,"mouseover",(function(){l.setOptions({strokeOpacity:1,strokeWeight:8})})),google.maps.event.addListener(l,"mouseout",(function(){l.setOptions({strokeOpacity:.5,strokeWeight:6})})),google.maps.event.addListener(l,"click",(function(){var e=a.getFeaturedData();m(e),f(e.firstUpdate.getTime(),e.lastUpdate.getTime())})),s=o,l.getPath().forEach((function(e){s.extend(e)})),l.setMap(e),A.push(l)}})),t){var s=new window.google.maps.Marker({position:t,map:e,icon:{url:"http://maps.google.com/mapfiles/kml/shapes/"+("LMFS"===h?"truck.png":"cabs.png"),scaledSize:new google.maps.Size(25,25)},title:"Last Location"});H.push(s)}return o}function B(){var e=Object(S.useRef)();return Object(S.useEffect)((function(){var t,a=_("zoom"),n=_("center");t=e.current,d=new google.maps.journeySharing.FleetEngineTripLocationProvider({projectId:g,authTokenFetcher:function(e){return console.log("Ignoring options using prebuilt jwt",e),{token:u}}}),s=new google.maps.journeySharing.JourneySharingMapView({element:t,locationProvider:d}).map,o();var i=W(s);a&&n?(console.log("setting zoom & center from url",a,n),s.setZoom(parseInt(a)),s.setCenter(JSON.parse(n))):s.fitBounds(i),s.addListener("zoom_changed",(function(){I("zoom",s.getZoom())})),s.addListener("center_changed",C.a.debounce((function(){I("center",JSON.stringify(s.getCenter().toJSON()))}),100))})),Object(F.jsx)("div",{ref:e,id:"map",style:{height:"500px"}})}function G(e){var t=["#2d7dd2","#97cc04","#eeb902","#f45d01","#474647","00aa00"];return t[e%t.length]}function z(e){p=e.logData.tripLogs,n=p.minDate.getTime(),i=p.maxDate.getTime();var t=new URLSearchParams(window.location.search);return r=t.get("apikey")||e.logData.apikey,u=e.logData.jwt,g=e.logData.projectId,h=e.logData.solutionType,Object(F.jsx)(k.Wrapper,{apiKey:r,render:q,version:"beta",libraries:["geometry","journeySharing"],children:Object(F.jsx)(B,{})})}var K=C.a.debounce((function(e,t){n=new Date(e),i=new Date(t),W(s),C.a.forEach(N,(function(e,t){J[t]&&e(!0)}))}),100);function Y(e,t){return function(a){C.a.forEach(J[e],(function(e){return e.setMap(null)})),delete J[e],a&&(J[e]=p.getLogs_(n,i).map((function(e){var a,o=C.a.get(e,"jsonPayload.request.vehicle.lastLocation"),n=void 0;return o&&(a=o.rawLocation)&&(n=t(new google.maps.LatLng({lat:a.latitude,lng:a.longitude}),o,e)),n})).compact().value())}}N.showGPSBubbles=Y("showGPSBubbles",(function(e,t){var a;switch(t.locSensor){case"LOCATION_SENSOR_GPS":case"LOCATION_SENSOR_FUSED_LOCATION_PROVIDER":a="#11FF11";break;case"LOCATION_SENSOR_NETWORK":a="#FF1111";break;case"LOCATION_SENSOR_PASSIVE":a="#FF0000";break;case"LOCATION_SENSOR_ROAD_SNAPPED_LOCATION_PROVIDER":a="#00FF00";break;default:a="#000000"}var o=t.rawLocationAccuracy;if(o){var n=new google.maps.Circle({strokeColor:a,strokeOpacity:.6,strokeWeight:2,fillColor:a,fillOpacity:.2,map:s,center:e,radius:o});return google.maps.event.addListener(n,"mouseover",(function(){m({rawLocationAccuracy:t.rawLocationAccuracy,locSensor:t.locSensor})})),n}})),N.showClientServerTimeDeltas=Y("showClientServerTimeDeltas",(function(e,t,a){var o=C.a.get(a,"jsonPayload.response.lastLocation.rawLocationTime"),n=C.a.get(a,"jsonPayload.response.lastLocation.serverTime");if(o&&n){var i,r=new Date(o),l=new Date(n),c=Math.abs(r.getTime()-l.getTime())/1e3;i=r>l?"#0000F0":"#0F0000";var u=new google.maps.Circle({strokeColor:i,strokeOpacity:.6,strokeWeight:2,fillColor:i,fillOpacity:.2,map:s,center:e,radius:c});return google.maps.event.addListener(u,"mouseover",(function(){m({timeDeltaSeconds:c,serverDate:l,clientDate:r})})),u}})),N.showHeading=Y("showHeading",(function(e,t,a){var o=C.a.get(a,"jsonPayload.request.vehicle.lastLocation.heading"),n=C.a.get(a,"jsonPayload.request.vehicle.lastLocation.bearingAccuracy");if(o&&n){var i=new google.maps.Polyline({strokeColor:"#0000F0",strokeOpacity:.6,strokeWeight:2,icons:[{icon:{path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW,strokeColor:"#0000FF",strokeWeight:4},offset:"100%"}],map:s,path:[e,google.maps.geometry.spherical.computeOffset(e,20,o)]});return google.maps.event.addListener(i,"click",(function(){c=new google.maps.StreetViewPanorama(document.getElementById("map"),{position:e,pov:{heading:o,pitch:10},addressControlOptions:{position:google.maps.ControlPosition.BOTTOM_CENTER},linksControl:!1,panControl:!1,enableCloseButton:!0}),console.log("loaded panorama",c)})),i}})),N.showSpeed=Y("showSpeed",(function(e,t){var a=t.speed;if(void 0!==t.speed){var o=a<0?"#FF0000":"#00FF00";return new google.maps.Circle({strokeColor:o,strokeOpacity:.5,fillColor:o,fillOpacity:.5,map:s,center:e,radius:Math.abs(a)})}})),N.showTraffic=function(e){l||(l=new google.maps.TrafficLayer),e?l.setMap(s):l.setMap(null)},N.showDwellLocations=function(e){var t="showDwellLocations",a=p.getDwellLocations(n,i);C.a.forEach(J[t],(function(e){return e.setMap(null)})),delete J[t],e&&(J[t]=C.a.map(a,(function(e){return new google.maps.Circle({strokeColor:"#000000",strokeOpacity:.25,fillColor:"#FFFF00",fillOpacity:.25,map:s,center:e.leaderCoords,radius:3*e.updates})})))},N.showHighVelocityJumps=function(e){var t="showHighVelocityJumps",a=p.getHighVelocityJumps(n,i);C.a.forEach(J[t],(function(e){return e.setMap(null)})),delete J[t],e?J[t]=C()(a).map((function(e){function t(e){return e<=100?2:e<1e3?6:e<2e3?10:14}var a=new window.google.maps.Polyline({path:[e.startLoc,e.endLoc],geodesic:!0,strokeColor:G(e.jumpIdx),strokeOpacity:.8,strokeWeight:t(e.velocity),map:s,icons:[{icon:{path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW,strokeColor:G(e.jumpIdx),strokeWeight:t(e.velocity)},offset:"100%"}]});return google.maps.event.addListener(a,"mouseover",(function(){m(e.getFeaturedData())})),google.maps.event.addListener(a,"click",(function(){m(e.getFeaturedData()),f(e.startDate.getTime()-6e4,e.endDate.getTime()+6e4)})),[a]})).flatten().value():f(p.minDate.getTime(),p.maxDate.getTime())},N.showMissingUpdates=function(e){var t="showMissingUpdates",a=p.getMissingUpdates(n,i);C.a.forEach(J[t],(function(e){return e.setMap(null)})),delete J[t],e?J[t]=C()(a).map((function(e){function t(e){return e<=6e4?2:e<6e5?6:e<36e6?10:14}var a=(google.maps.geometry.spherical.computeHeading(e.startLoc,e.endLoc)+360+90)%360-180,o=[e.startLoc,google.maps.geometry.spherical.computeOffset(e.startLoc,1e3,a),google.maps.geometry.spherical.computeOffset(e.startLoc,900,a),google.maps.geometry.spherical.computeOffset(e.endLoc,900,a),google.maps.geometry.spherical.computeOffset(e.endLoc,1e3,a),e.endLoc],n=new window.google.maps.Polyline({path:o,geodesic:!0,strokeColor:"#008B8B",strokeOpacity:.5,strokeWeight:t(e.interval),map:s,icons:[{icon:{path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW,strokeColor:"#008B8B",strokeWeight:t(e.interval),scale:6},offset:"50%"},{icon:{path:google.maps.SymbolPath.CIRCLE,scale:6,strokeColor:"#000000",strokeWeight:1,strokeOpacity:.5},offset:"0%"},{icon:{path:google.maps.SymbolPath.CIRCLE,scale:6,strokeColor:"#000000",strokeWeight:1,strokeOpacity:.5},offset:"100%"}]});return google.maps.event.addListener(n,"mouseover",(function(){m(e.getFeaturedData()),n.setOptions({strokeOpacity:1,strokeWeight:1.5*t(e.interval)})})),google.maps.event.addListener(n,"mouseout",(function(){n.setOptions({strokeOpacity:.5,strokeWeight:t(e.interval)})})),google.maps.event.addListener(n,"click",(function(){m(e.getFeaturedData()),f(e.startDate.getTime()-6e4,e.endDate.getTime()+6e4)})),[n]})).flatten().value():f(p.minDate.getTime(),p.maxDate.getTime())},N.showLiveJS=function(e){u?d.tripId=e?C.a.last(p.getTripIDs()):"":console.log("Issue #25 -- no/invalid jwt")};var X=a(48),Z=a.n(X);var Q=function(e){return Object(F.jsx)(Z.a,{src:e.featuredObject,onSelect:e.onClick})},$=a(33),ee=(a(148),(0,$.a.createSliderWithTooltip)($.a.Range)),te={width:"100%"};var ae,oe=function(e){var t=e.logData.tripLogs,a={};C.a.map(t.getTripStatusChanges(),(function(e){a[e.date.getTime()]={}}));var o=t.minDate.getTime(),n=t.maxDate.getTime(),i=C.a.max([o,e.curMin]),s=C.a.min([n,e.curMax]);return Object(F.jsx)("div",{style:te,children:Object(F.jsx)(ee,{min:o,max:n,marks:a,step:1,onChange:function(t){e.onSliderChange({minTime:t[0],maxTime:t[1]})},defaultValue:[o,n],value:[i,s],tipFormatter:function(e){var a=new Date(e),o=t.getTripStatusAtDate(new Date(e));return"".concat(a).concat(o)}})})},ne=a(11),ie=a(52),se=a(12),re=se.a.div(ae||(ae=Object(ne.a)(["\n  padding: 1rem;\n\n  table {\n    border-spacing: 0;\n    border: 1px solid black;\n\n    tr {\n      :last-child {\n        td {\n          border-bottom: 0;\n        }\n      }\n    }\n\n    th,\n    td {\n      margin: 0;\n      padding: 0.5rem;\n      border-bottom: 1px solid black;\n      border-right: 1px solid black;\n\n      :last-child {\n        border-right: 0;\n      }\n    }\n  }\n"])));function le(e){var t=e.columns,a=e.data,o=e.onSelectionChange,n=Object(ie.useTable)({columns:t,data:a}),i=n.getTableProps,s=n.getTableBodyProps,r=n.headerGroups,l=n.rows,c=n.prepareRow;return Object(F.jsxs)("table",Object(P.a)(Object(P.a)({},i()),{},{children:[Object(F.jsx)("thead",{children:r.map((function(e){return Object(F.jsx)("tr",Object(P.a)(Object(P.a)({},e.getHeaderGroupProps()),{},{children:e.headers.map((function(e){return Object(F.jsx)("th",Object(P.a)(Object(P.a)({},e.getHeaderProps()),{},{children:e.render("Header")}))}))}))}))}),Object(F.jsx)("tbody",Object(P.a)(Object(P.a)({},s()),{},{children:l.map((function(e){return c(e),Object(F.jsx)("tr",Object(P.a)(Object(P.a)({},e.getRowProps()),{},{onClick:function(){return o(e.original)},children:e.cells.map((function(e){return Object(F.jsx)("td",Object(P.a)(Object(P.a)({},e.getCellProps()),{},{children:e.render("Cell")}))}))}))}))}))]}))}var ce,ue,ge,de=function(e){var t=e.value,a=e.trim;return Object(F.jsx)(F.Fragment,{children:t&&t.replace(a,"")})};function he(e){var t=e.timeRange.minTime,a=e.timeRange.maxTime,o=e.logData.tripLogs.getLogs_(new Date(t),new Date(a)).value(),n=D.a.useMemo((function(){var t=[{Header:"Date",accessor:"formattedDate"},{Header:"SDK Version",accessor:"jsonPayload.request.header.sdkVersion"},{Header:"OS Version",accessor:"jsonPayload.request.header.osVersion"},{Header:"Method",accessor:"jsonPayload.@type",Cell:function(e){var t=e.cell.value;return Object(F.jsx)(de,{value:t,trim:"type.googleapis.com/maps.fleetengine."})}},{Header:"Vehicle",accessor:"labels.vehicle_id"},{Header:"Trip",accessor:"labels.trip_id"},{Header:"Vehicle State",accessor:"jsonPayload.response.state",Cell:function(e){var t=e.cell.value;return Object(F.jsx)(de,{value:t,trim:"VEHICLE_STATE_"})}},{Header:"Trip Status",accessor:"jsonPayload.response.status",Cell:function(e){var t=e.cell.value;return Object(F.jsx)(de,{value:t,trim:"TRIP_STATUS_"})}},{Header:"Nav Status",accessor:"jsonPayload.response.navStatus",Cell:function(e){var t=e.cell.value;return Object(F.jsx)(de,{value:t,trim:"NAVIGATION_STATUS_"})}}];return C.a.map(e.extraColumns,(function(e){var a=e.split(".");t.push({Header:a[a.length-1],accessor:e})})),[{Header:"Log Entries (click row to view full log entry)",columns:t}]}),[e.extraColumns]);return Object(F.jsx)(re,{children:Object(F.jsx)(le,{columns:n,data:o,onSelectionChange:e.onSelectionChange})})}var pe=se.a.button(ce||(ce=Object(ne.a)([""]))),me=Object(se.a)(pe)(ue||(ue=Object(ne.a)(["\n  opacity: 0.6;\n  ","\n"])),(function(e){return e.active&&"\n    opacity: 1;\n    color: Green;\n  "})),fe=se.a.div(ge||(ge=Object(ne.a)(["\n  display: flex;\n"])));var ve=function(e){var t=e.toggleState,a=C.a.map(e.toggles,(function(a){return Object(F.jsxs)(me,{active:t[a.id],onClick:function(){return e.clickHandler(a.id)},children:[a.name,Object(F.jsx)("a",{href:a.docLink,target:"_blank",rel:"noreferrer",children:"?"})]},a.id)}));return Object(F.jsx)(fe,{children:a})};function we(e,t){return"true"===_(e)&&(t=!0),t}var ye,be,je,Le,Oe,Se=function(e){Object(L.a)(a,e);var t=Object(O.a)(a);function a(e){var o;Object(b.a)(this,a),o=t.call(this,e);var n=new Date,i=_("minTime"),s=_("maxTime");return o.initialMinTime=i?parseInt(i):0,o.initialMaxTime=s?parseInt(s):n.setFullYear(n.getFullYear()+1),o.logData=e.logData,o.state={timeRange:{minTime:o.initialMinTime,maxTime:o.initialMaxTime},featuredObject:{msg:"Click a table row to select object"},extraColumns:[],toggleOptions:{showGPSBubbles:we("showGPSBubbles",!1),showHeading:we("showHeading",!1),showSpeed:we("showSpeed",!1),showTraffic:we("showTraffic",!1),showDwellLocations:we("showDwellLocations",!1),showHighVelocityJumps:we("showHighVelocityJumps",!1),showMissingUpdates:we("showMissingUpdates",!1),showLiveJS:we("showLiveJS",!1),showClientServerTimeDeltas:we("showClientServerTimeDeltas",!1)}},o.onSliderChangeDebounced=C.a.debounce((function(e){return o.onSliderChange(e)}),25),m=function(e){return o.setFeaturedObject(e)},f=function(e,t){return o.setTimeRange(e,t)},o.toggles=[{id:"showGPSBubbles",name:"GPS Accuracy",docLink:"https://github.com/googlemaps/fleet-debugger/blob/main/docs/GPSAccuracy.md",columns:["jsonPayload.request.vehicle.lastLocation.rawLocationAccuracy","jsonPayload.request.vehicle.lastLocation.locSensor"]},{id:"showHeading",name:"Heading",docLink:"https://github.com/googlemaps/fleet-debugger/blob/main/docs/Heading.md",columns:["jsonPayload.request.vehicle.lastLocation.heading","jsonPayload.request.vehicle.lastLocation.bearingAccuracy"]},{id:"showSpeed",name:"Speed",docLink:"https://github.com/googlemaps/fleet-debugger/blob/main/docs/Speed.md",columns:["jsonPayload.request.vehicle.lastLocation.speed"]},{id:"showDwellLocations",name:"Dwell Locations",docLink:"https://github.com/googlemaps/fleet-debugger/blob/main/docs/DwellTimes.md",columns:[]},{id:"showHighVelocityJumps",name:"Jumps (unrealistic velocity)",docLink:"https://github.com/googlemaps/fleet-debugger/blob/main/docs/VelocityJumps.md",columns:["jsonPayload.request.vehicle.lastLocation.speed"]},{id:"showMissingUpdates",name:"Jumps (Temporal)",docLink:"https://github.com/googlemaps/fleet-debugger/blob/main/docs/MissingUpdates.md",columns:["jsonPayload.temporal_gap"]},{id:"showClientServerTimeDeltas",name:"Client/Server Time Deltas",docLink:"https://github.com/googlemaps/fleet-debugger/blob/main/README.md",columns:["jsonPayload.response.lastLocation.rawLocationTime","jsonPayload.response.lastLocation.serverTime"]},{id:"showTraffic",name:"Traffic",docLink:"https://github.com/googlemaps/fleet-debugger/blob/main/README.md",columns:[]},{id:"showLiveJS",name:"Start Live Journey Sharing for newest trip",docLink:"https://github.com/googlemaps/fleet-debugger/blob/main/README.md",columns:[]}],o}return Object(j.a)(a,[{key:"componentDidMount",value:function(){var e=this;V.then((function(){e.setTimeRange(e.initialMinTime,e.initialMaxTime),C.a.map(e.toggles,(function(t){"true"===_(t.id)&&e.updateToggleState(!0,t.id,t.columns)}))}))}},{key:"updateToggleState",value:function(e,t,a){this.setState((function(o){o.toggleOptions[t]=e,function(e,t){N[e](t)}(t,e),I(t,e);var n=C.a.clone(o.extraColumns);return C.a.forEach(a,(function(t){e?n.push(t):C.a.pull(n,t)})),o.extraColumns=C.a.uniq(n),o}))}},{key:"onSliderChange",value:function(e){this.setTimeRange(e.minTime,e.maxTime)}},{key:"onSelectionChange",value:function(e){!function(e){C.a.forEach(U,(function(e){return e.setMap(null)})),U=[];var t={path:"M10.453 14.016l6.563-6.609-1.406-1.406-5.156 5.203-2.063-2.109-1.406 1.406zM12 2.016q2.906 0 4.945 2.039t2.039 4.945q0 1.453-0.727 3.328t-1.758 3.516-2.039 3.070-1.711 2.273l-0.75 0.797q-0.281-0.328-0.75-0.867t-1.688-2.156-2.133-3.141-1.664-3.445-0.75-3.375q0-2.906 2.039-4.945t4.945-2.039z",fillColor:"blue",fillOpacity:.6,strokeWeight:0,rotation:0,scale:2,anchor:new google.maps.Point(15,30)},a=C.a.get(e,"jsonPayload.request.vehicle.lastLocation.rawLocation");if(a){var o=C.a.get(e,"jsonPayload.response.status"),n=C.a.get(e,"jsonPayload.response.state"),i=new window.google.maps.Marker({position:{lat:a.latitude,lng:a.longitude},map:s,icon:t,title:"Vehicle state "+n+" Trip Status "+o});U.push(i)}}(e),this.setFeaturedObject(e)}},{key:"setFeaturedObject",value:function(e){this.setState({featuredObject:e})}},{key:"setTimeRange",value:function(e,t){I("minTime",e),I("maxTime",t),this.setState({timeRange:{minTime:e,maxTime:t}}),K(e,t)}},{key:"onDataframePropClick",value:function(e){this.setState((function(t){var a=C.a.join(e.namespace,".")+"."+e.name;return{extraColumns:C.a.find(t.extraColumns,(function(e){return e===a}))?C.a.without(t.extraColumns,a):[].concat(Object(y.a)(t.extraColumns),[a])}}))}},{key:"toggleClickHandler",value:function(e){var t=C.a.find(this.toggles,{id:e}),a=!this.state.toggleOptions[e];this.updateToggleState(a,e,t.columns)}},{key:"render",value:function(){var e=this;return Object(F.jsxs)("div",{children:[Object(F.jsx)(oe,{logData:this.logData,curMin:this.state.timeRange.minTime,curMax:this.state.timeRange.maxTime,onSliderChange:this.onSliderChangeDebounced}),Object(F.jsx)(ve,{toggles:this.toggles,toggleState:this.state.toggleOptions,clickHandler:function(t){return e.toggleClickHandler(t)}}),Object(F.jsxs)("div",{style:{width:"100%",marginTop:"20px"},children:[Object(F.jsx)("div",{style:{width:"65%",overflowX:"scroll",overFlowY:"scroll",height:"100%",float:"left"},children:Object(F.jsx)(he,{logData:this.logData,style:{width:"100%"},timeRange:this.state.timeRange,extraColumns:this.state.extraColumns,onSelectionChange:function(t){return e.onSelectionChange(t)}})}),Object(F.jsx)("div",{style:{marginLeft:"65%",overFlowX:"scroll",overFlowY:"scroll",height:"100%"},children:Object(F.jsx)(Q,{featuredObject:this.state.featuredObject,onClick:function(t){return e.onDataframePropClick(t)}})})]})]})}}]),a}(D.a.Component),De=a(20),ke=a.n(De),Te=a(56),Ce=function(){function e(){Object(b.a)(this,e)}return Object(j.a)(e,null,[{key:"formatDuration",value:function(e){var t=e/1e3,a=Math.floor(t/3600),o=Math.floor((t-3600*a)/60),n=Math.floor(t-3600*a-60*o),i="";return a>0&&(i+=a+" hours "),o>0&&(i+=o+" minutes "),n>0&&(i+=n+" seconds"),i}}]),e}(),xe=function(){function e(t,a,o){Object(b.a)(this,e),this.tripIdx=t,this.tripName=a,this.updateRequests=1,this.pathCoords=[],this.tripDuration=0,this.creationTime="Unknown",this.firstUpdate=o,this.lastUpdate="Unknown"}return Object(j.a)(e,[{key:"getTraveledDistance",value:function(){return window.google.maps.geometry.spherical.computeLength(this.pathCoords)}},{key:"getFeaturedData",value:function(){return{updateRequests:this.updateRequests,tripName:this.tripName,duration:Ce.formatDuration(this.tripDuration),creationTime:this.creationTime,traveledDistanceKilometers:this.getTraveledDistance()/1e3,traveledDistanceMiles:this.getTraveledDistance()/1609,firstUpdate:this.firstUpdate,lastUpdate:this.lastUpdate}}},{key:"getPathCoords",value:function(e,t){return e&&t?C()(this.pathCoords).filter((function(a){return a.date>=e&&a.date<=t})).value():this.pathCoords}},{key:"appendCoords",value:function(e,t){this.pathCoords.push({lat:e.rawLocation.latitude,lng:e.rawLocation.longitude,trip_id:this.tripName,date:new Date(t)})}}]),e}(),Pe=function(){function e(){Object(b.a)(this,e)}return Object(j.a)(e,null,[{key:"median",value:function(e){if(1===e.length)return e[0];var t=Object(y.a)(e).sort(),a=Math.ceil(t.length/2),o=Math.floor(t.length/2);return a===o?t[o]:(t[a]+t[o])/2}}]),e}(),Me=0,Ee=function(){function e(t,a,o){Object(b.a)(this,e);var n=C.a.get(a,"jsonPayload.request.vehicle.lastLocation"),i=C.a.get(o,"jsonPayload.request.vehicle.lastLocation"),s=new google.maps.LatLng({lat:n.rawLocation.latitude,lng:n.rawLocation.longitude}),r=new google.maps.LatLng({lat:i.rawLocation.latitude,lng:i.rawLocation.longitude}),l=window.google.maps.geometry.spherical.computeDistanceBetween(s,r),c=o.date-a.date,u=l/(c/1e3);this.entry=o,this.prevEntry=a,this.timeSpentMS=c,this.distanceTraveled=l,this.velocity=u,this.startLoc=s,this.startDate=a.date,this.endDate=o.date,this.endLoc=r,this.jumpIdx=t}return Object(j.a)(e,[{key:"getFeaturedData",value:function(){return{timeSpentMS:this.timeSpentMS,distanceTraveled:this.distanceTraveled,velocity:this.velocity,velocityMPH:2.237*this.velocity,startLoc:this.startLoc.toString(),startDate:this.prevEntry.date,endDate:this.entry.date,endLoc:this.endLoc.toString(),jumpIdx:this.jumpIdx,date:this.entry.date,computedOutlierVelocity:Me}}},{key:"getLogViewerEntry",value:function(){var e=this.getFeaturedData();return e.timestampMS=this.startDate.getTime(),e.formattedDate=this.startDate.toISOString(),e.jsonPayload={"@type":"Jump",request:{vehicle:{lastLocation:{speed:this.velocity}}}},e}}],[{key:"getSignificantJumps",value:function(e){if(!e)return[];var t=C.a.map(e,"velocity"),a=C.a.mean(t),o=Pe.median(t),n=C.a.min(t),i=C.a.max(t);return console.log("avgVelocity",a),console.log("medianVelocity",o),console.log("minVelocity",n),console.log("maxVelocity",i),Me=C.a.min([68,100*o]),C()(e).filter((function(e){return e.velocity>=Me})).sortBy("velocity").value()}}]),e}(),Re=0,_e=function(){function e(t,a,o){Object(b.a)(this,e);var n=o.date-a.date,i=C.a.get(o,"jsonPayload.request.vehicle.lastLocation"),s=C.a.get(a,"jsonPayload.request.vehicle.lastLocation"),r=new google.maps.LatLng({lat:s.rawLocation.latitude,lng:s.rawLocation.longitude}),l=new google.maps.LatLng({lat:i.rawLocation.latitude,lng:i.rawLocation.longitude});this.entry=o,this.prevEntry=a,this.interval=n,this.startLoc=r,this.startDate=a.date,this.endDate=o.date,this.endLoc=l,this.idx=t,this.startVehicleState=C.a.get(o,"jsonPayload.response.state"),this.endVehicleState=C.a.get(a,"jsonPayload.response.state"),this.duration=Ce.formatDuration(this.interval)}return Object(j.a)(e,[{key:"getFeaturedData",value:function(){return{duration:this.duration,interval:this.interval,startDate:this.startDate,startLoc:this.startLoc.toString(),endDate:this.endDate,endLoc:this.endLoc.toString(),startVehicleState:this.startVehicleState,endVehicleState:this.endVehicleState,computedOutlier:Ce.formatDuration(Re)}}},{key:"getStateTransition",value:function(){return this.startVehicleState.replace("VEHICLE_STATE_","")+">"+this.endVehicleState.replace("VEHICLE_STATE_","")}},{key:"getLogViewerEntry",value:function(){var e=this.getFeaturedData();return e.date=this.startDate,e.timestampMS=this.startDate.getTime(),e.formattedDate=this.startDate.toISOString(),e.jsonPayload={"@type":"Missing Updates",temporal_gap:e.duration,response:{state:this.getStateTransition()}},e}}],[{key:"getSignificantMissingUpdates",value:function(e){if(!e)return[];var t=C.a.map(e,"interval"),a=C.a.mean(t),o=Pe.median(t),n=C.a.min(t),i=C.a.max(t);return console.log("avgInternal",a),console.log("medianInternal",o),console.log("minInternal",n),console.log("maxInternal",i),console.log("updateOutlier",6e4),Re=C.a.min([10*o,6e4]),console.log("computedOutlier",Re),C()(e).filter((function(e){return e.interval>=Re})).sortBy("interval").value()}}]),e}(),Ie=function(){function e(t,a){Object(b.a)(this,e),this.solutionType=a,"LMFS"===this.solutionType?(this.updateVehicleSuffix="update_delivery_vehicle",this.lastLocationPath="jsonPayload.request.deliveryVehicle.lastLocation"):(this.updateVehicleSuffix="update_vehicle",this.vehicleName="vehicle",this.lastLocationPath="jsonPayload.request.vehicle.lastLocation"),this.trip_ids=[],this.trips=[],this.tripStatusChanges=[],this.rawLogs=C.a.reverse(t),this.processTripSegments(),this.minDate=new Date(t[0].timestamp),this.maxDate=new Date(C.a.last(t).timestamp),this.velocityJumps=[],this.missingUpdates=[],this.dwellLocations=[],C.a.map(this.rawLogs,(function(e,t){e.date=new Date(e.timestamp),e.formattedDate=e.date.toISOString(),e.timestampMS=e.date.getTime(),e.idx=t}))}return Object(j.a)(e,[{key:"getRawLogs_",value:function(e,t){return e=e||this.minDate,t=t||this.maxDate,C()(this.rawLogs).filter((function(a){return a.date>=e&&a.date<=t}))}},{key:"getLogs_",value:function(e,t){return this.getRawLogs_(e,t).concat(this.velocityJumps.map((function(e){return e.getLogViewerEntry()}))).concat(this.missingUpdates.map((function(e){return e.getLogViewerEntry()}))).filter((function(a){return a.date>=e&&a.date<=t})).sortBy("timestampMS")}},{key:"getTripStatusChanges",value:function(){return this.tripStatusChanges}},{key:"getTripStatusAtDate",value:function(e){var t=C.a.sortedIndexBy(this.tripStatusChanges,{date:e},"date");if(t>=1)return this.tripStatusChanges[t-1].newStatus}},{key:"getTripIDs",value:function(){return this.trip_ids}},{key:"getTrips",value:function(){return this.trips}},{key:"getMissingUpdates",value:function(e,t){var a,o=this,n=this.getRawLogs_(e,t).filter((function(e){return C.a.get(e,o.lastLocationPath+".rawLocation")})).map((function(e){var t;return a&&(t=new _e(e.idx,a,e)),a=e,t})).compact().value();return this.missingUpdates=_e.getSignificantMissingUpdates(n),this.missingUpdates}},{key:"getHighVelocityJumps",value:function(e,t){var a,o=this,n=this.getRawLogs_(e,t).filter((function(e){return C.a.get(e,o.lastLocationPath+".rawLocation")})).map((function(e){var t;return a&&(t=new Ee(e.idx,a,e)),a=e,t})).compact().value();return this.velocityJumps=Ee.getSignificantJumps(n),this.velocityJumps}},{key:"getDwellLocations",value:function(e,t){var a=this,o=[];return C.a.forEach(this.rawLogs,(function(n){var i=C.a.get(n,a.lastLocationPath);if(!(!i||!i.rawLocation||n.date<e||n.date>t)){var s={lat:i.rawLocation.latitude,lng:i.rawLocation.longitude},r=C.a.find(o,(function(e){return window.google.maps.geometry.spherical.computeDistanceBetween(e.leaderCoords,new google.maps.LatLng(s))<=20}));r?r.updates++:o.push({leaderCoords:new window.google.maps.LatLng(s),updates:1})}})),this.dwellLocations=C.a.filter(o,(function(e){return e.updates>=12})),this.dwellLocations}},{key:"getSegmentID",value:function(e){if("LMFS"===this.solutionType){var t=C.a.get(e,"jsonPayload.response.remainingVehicleJourneySegments");return t&&"Stops Left "+t.length}return C.a.get(e,"labels.trip_id")}},{key:"processTripSegments",value:function(){var e=this,t="this is not a segment",a=void 0,o=0,n=0,i="no status";C.a.forEach(this.rawLogs,(function(s){if(s.logName.match(e.updateVehicleSuffix)){var r=e.getSegmentID(s);if(r!==t)t=r,a=new xe(o,r||"non-trip-segment-"+n,new Date(s.timestamp)),e.trips.push(a),e.trip_ids.push(a.tripName),o++,void 0===r&&n++;else a.lastUpdate=new Date(s.timestamp),a.tripDuration=a.lastUpdate-a.firstUpdate,a.updateRequests++;var l=C.a.get(s,e.lastLocationPath);l&&l.rawLocation&&a.appendCoords(l,s.timestamp)}var c=C.a.get(s,"jsonPayload.response.status");c&&c!==i&&(e.tripStatusChanges.push({newStatus:c,date:new Date(s.timestamp)}),i=c)}))}}]),e}();function Fe(){return(Fe=Object(Te.a)(ke.a.mark((function e(){var t,a;return ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("./data.json");case 2:return t=e.sent,e.next=5,t.json();case 5:a=e.sent,ye=a.jwt,be=a.projectId,je=a.APIKEY,Le=a.solutionType,Oe=new Ie(a.rawLogs,Le);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}(function(){return Fe.apply(this,arguments)})().then((function(){var e={tripLogs:Oe,apikey:je,jwt:ye,projectId:be,solutionType:Le};w.a.render(Object(F.jsxs)("div",{children:[Object(F.jsx)(z,{logData:e}),Object(F.jsx)(Se,{logData:e})]}),document.getElementById("root"))}))}},[[151,1,2]]]);
//# sourceMappingURL=main.6cbcd1f9.chunk.js.map