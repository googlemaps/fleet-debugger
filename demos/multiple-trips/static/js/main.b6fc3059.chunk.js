(this["webpackJsonpdune-buggy"]=this["webpackJsonpdune-buggy"]||[]).push([[0],{139:function(e,t,a){"use strict";a.r(t);var o,n,i,s,r,l,c,u,g,d,h,p,m,f=a(6),v=a.n(f),w=a(20),y=a(4),j=a(5),b=a(53),O=a(52),L=a(0),S=a.n(L),k=a(21),C=a(1),D=a.n(C),T=a(2),x=[],P=[],M=[],_={},E={},V=function(e){return e===k.Status.LOADING?Object(T.jsxs)("h3",{children:[e," .."]}):e===k.Status.FAILURE?Object(T.jsxs)("h3",{children:[e," ..."]}):null};function R(e){D.a.forEach(x,(function(e){return e.setMap(null)})),x=[],D.a.forEach(P,(function(e){return e.setMap(null)})),P=[];var t,a=h.getTrips(),i=new window.google.maps.LatLngBounds;if(D.a.forEach(a,(function(a){var s,r=a.getPathCoords(o,n);if(r.length>0){t=D.a.last(r);var l=new window.google.maps.Polyline({path:r,geodesic:!0,strokeColor:I(a.tripIdx),strokeOpacity:.5,strokeWeight:6});google.maps.event.addListener(l,"mouseover",(function(){l.setOptions({strokeOpacity:1,strokeWeight:8})})),google.maps.event.addListener(l,"mouseout",(function(){l.setOptions({strokeOpacity:.5,strokeWeight:6})})),google.maps.event.addListener(l,"click",(function(){var e=a.getFeaturedData();p(e),m(e.firstUpdate.getTime(),e.lastUpdate.getTime())})),s=i,l.getPath().forEach((function(e){s.extend(e)})),l.setMap(e),x.push(l)}})),t){var s=new window.google.maps.Marker({position:t,map:e,icon:{url:"http://maps.google.com/mapfiles/kml/shapes/"+("LMFS"===d?"truck.png":"cabs.png"),scaledSize:new google.maps.Size(25,25)},title:"Last Location"});P.push(s)}return i}function F(){var e=Object(L.useRef)();return Object(L.useEffect)((function(){var t;t=e.current,g=new google.maps.journeySharing.FleetEngineTripLocationProvider({projectId:u,authTokenFetcher:function(e){return console.log("Ignoring options using prebuilt jwt",e),{token:c}}});var a=R(i=new google.maps.journeySharing.JourneySharingMapView({element:t,locationProvider:g}).map);i.fitBounds(a)})),Object(T.jsx)("div",{ref:e,id:"map",style:{height:"500px"}})}function I(e){var t=["#2d7dd2","#97cc04","#eeb902","#f45d01","#474647","00aa00"];return t[e%t.length]}function H(e){h=e.logData.tripLogs,o=h.minDate.getTime(),n=h.maxDate.getTime();var t=new URLSearchParams(window.location.search);return s=t.get("apikey")||e.logData.apikey,c=e.logData.jwt,u=e.logData.projectId,d=e.logData.solutionType,Object(T.jsx)(k.Wrapper,{apiKey:s,render:V,version:"beta",libraries:["geometry","journeySharing"],children:Object(T.jsx)(F,{})})}var U=D.a.debounce((function(e,t){o=new Date(e),n=new Date(t),R(i),D.a.forEach(E,(function(e,t){_[t]&&e(!0)}))}),100);function J(e,t){return function(a){D.a.forEach(_[e],(function(e){return e.setMap(null)})),delete _[e],a&&(_[e]=h.getLogs_(o,n).map((function(e){var a,o=D.a.get(e,"jsonPayload.request.vehicle.lastLocation"),n=void 0;return o&&(a=o.rawLocation)&&(n=t(new google.maps.LatLng({lat:a.latitude,lng:a.longitude}),o,e)),n})).compact().value())}}E.showGPSBubbles=J("showGPSBubbles",(function(e,t){var a;switch(t.locSensor){case"LOCATION_SENSOR_GPS":case"LOCATION_SENSOR_FUSED_LOCATION_PROVIDER":a="#11FF11";break;case"LOCATION_SENSOR_NETWORK":a="#FF1111";break;case"LOCATION_SENSOR_PASSIVE":a="#FF0000";break;case"LOCATION_SENSOR_ROAD_SNAPPED_LOCATION_PROVIDER":a="#00FF00";break;default:a="#000000"}var o=t.rawLocationAccuracy;if(o){var n=new google.maps.Circle({strokeColor:a,strokeOpacity:.6,strokeWeight:2,fillColor:a,fillOpacity:.2,map:i,center:e,radius:o});return google.maps.event.addListener(n,"mouseover",(function(){p({rawLocationAccuracy:t.rawLocationAccuracy,locSensor:t.locSensor})})),n}})),E.showClientServerTimeDeltas=J("showClientServerTimeDeltas",(function(e,t,a){var o=D.a.get(a,"jsonPayload.response.lastLocation.rawLocationTime"),n=D.a.get(a,"jsonPayload.response.lastLocation.serverTime");if(o&&n){var s,r=new Date(o),l=new Date(n),c=Math.abs(r.getTime()-l.getTime())/1e3;s=r>l?"#0000F0":"#0F0000";var u=new google.maps.Circle({strokeColor:s,strokeOpacity:.6,strokeWeight:2,fillColor:s,fillOpacity:.2,map:i,center:e,radius:c});return google.maps.event.addListener(u,"mouseover",(function(){p({timeDeltaSeconds:c,serverDate:l,clientDate:r})})),u}})),E.showHeading=J("showHeading",(function(e,t,a){var o=D.a.get(a,"jsonPayload.request.vehicle.lastLocation.heading"),n=D.a.get(a,"jsonPayload.request.vehicle.lastLocation.bearingAccuracy");if(o&&n){var s=new google.maps.Polyline({strokeColor:"#0000F0",strokeOpacity:.6,strokeWeight:2,icons:[{icon:{path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW,strokeColor:"#0000FF",strokeWeight:4},offset:"100%"}],map:i,path:[e,google.maps.geometry.spherical.computeOffset(e,20,o)]});return google.maps.event.addListener(s,"click",(function(){l=new google.maps.StreetViewPanorama(document.getElementById("map"),{position:e,pov:{heading:o,pitch:10},addressControlOptions:{position:google.maps.ControlPosition.BOTTOM_CENTER},linksControl:!1,panControl:!1,enableCloseButton:!0}),console.log("loaded panorama",l)})),s}})),E.showSpeed=J("showSpeed",(function(e,t){var a=t.speed;if(void 0!==t.speed){var o=a<0?"#FF0000":"#00FF00";return new google.maps.Circle({strokeColor:o,strokeOpacity:.5,fillColor:o,fillOpacity:.5,map:i,center:e,radius:Math.abs(a)})}})),E.showTraffic=function(e){r||(r=new google.maps.TrafficLayer),e?r.setMap(i):r.setMap(null)},E.showDwellLocations=function(e){var t="showDwellLocations",a=h.getDwellLocations(o,n);D.a.forEach(_[t],(function(e){return e.setMap(null)})),delete _[t],e&&(_[t]=D.a.map(a,(function(e){return new google.maps.Circle({strokeColor:"#000000",strokeOpacity:.25,fillColor:"#FFFF00",fillOpacity:.25,map:i,center:e.leaderCoords,radius:3*e.updates})})))},E.showHighVelocityJumps=function(e){var t="showHighVelocityJumps",a=h.getHighVelocityJumps(o,n);D.a.forEach(_[t],(function(e){return e.setMap(null)})),delete _[t],e?_[t]=D()(a).map((function(e){function t(e){return e<=100?2:e<1e3?6:e<2e3?10:14}var a=new window.google.maps.Polyline({path:[e.startLoc,e.endLoc],geodesic:!0,strokeColor:I(e.jumpIdx),strokeOpacity:.8,strokeWeight:t(e.velocity),map:i,icons:[{icon:{path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW,strokeColor:I(e.jumpIdx),strokeWeight:t(e.velocity)},offset:"100%"}]});return google.maps.event.addListener(a,"mouseover",(function(){p(e.getFeaturedData())})),google.maps.event.addListener(a,"click",(function(){p(e.getFeaturedData()),m(e.startDate.getTime()-6e4,e.endDate.getTime()+6e4)})),[a]})).flatten().value():m(h.minDate.getTime(),h.maxDate.getTime())},E.showMissingUpdates=function(e){var t="showMissingUpdates",a=h.getMissingUpdates(o,n);D.a.forEach(_[t],(function(e){return e.setMap(null)})),delete _[t],e?_[t]=D()(a).map((function(e){function t(e){return e<=6e4?2:e<6e5?6:e<36e6?10:14}var a=(google.maps.geometry.spherical.computeHeading(e.startLoc,e.endLoc)+360+90)%360-180,o=[e.startLoc,google.maps.geometry.spherical.computeOffset(e.startLoc,1e3,a),google.maps.geometry.spherical.computeOffset(e.startLoc,900,a),google.maps.geometry.spherical.computeOffset(e.endLoc,900,a),google.maps.geometry.spherical.computeOffset(e.endLoc,1e3,a),e.endLoc],n=new window.google.maps.Polyline({path:o,geodesic:!0,strokeColor:"#008B8B",strokeOpacity:.5,strokeWeight:t(e.interval),map:i,icons:[{icon:{path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW,strokeColor:"#008B8B",strokeWeight:t(e.interval),scale:6},offset:"50%"},{icon:{path:google.maps.SymbolPath.CIRCLE,scale:6,strokeColor:"#000000",strokeWeight:1,strokeOpacity:.5},offset:"0%"},{icon:{path:google.maps.SymbolPath.CIRCLE,scale:6,strokeColor:"#000000",strokeWeight:1,strokeOpacity:.5},offset:"100%"}]});return google.maps.event.addListener(n,"mouseover",(function(){p(e.getFeaturedData()),n.setOptions({strokeOpacity:1,strokeWeight:1.5*t(e.interval)})})),google.maps.event.addListener(n,"mouseout",(function(){n.setOptions({strokeOpacity:.5,strokeWeight:t(e.interval)})})),google.maps.event.addListener(n,"click",(function(){p(e.getFeaturedData()),m(e.startDate.getTime()-6e4,e.endDate.getTime()+6e4)})),[n]})).flatten().value():m(h.minDate.getTime(),h.maxDate.getTime())},E.showLiveJS=function(e){c?g.tripId=e?D.a.last(h.getTripIDs()):"":console.log("Issue #25 -- no/invalid jwt")};var A=a(43),B=a.n(A);var q=function(e){return Object(T.jsx)(B.a,{src:e.featuredObject,onSelect:e.onClick})},N=a(30),W=(a(136),(0,N.a.createSliderWithTooltip)(N.a.Range)),G={width:"100%"};var K,Y=function(e){var t=e.logData.tripLogs,a={};D.a.map(t.getTripStatusChanges(),(function(e){a[e.date.getTime()]={}}));var o=t.minDate.getTime(),n=t.maxDate.getTime(),i=D.a.max([o,e.curMin]),s=D.a.min([n,e.curMax]);return Object(T.jsx)("div",{style:G,children:Object(T.jsx)(W,{min:o,max:n,marks:a,step:1,onChange:function(t){e.onSliderChange({minTime:t[0],maxTime:t[1]})},defaultValue:[o,n],value:[i,s],tipFormatter:function(e){var a=new Date(e),o=t.getTripStatusAtDate(new Date(e));return"".concat(a).concat(o)}})})},z=a(7),X=a(11),Q=a(47),Z=a(12),$=Z.a.div(K||(K=Object(X.a)(["\n  padding: 1rem;\n\n  table {\n    border-spacing: 0;\n    border: 1px solid black;\n\n    tr {\n      :last-child {\n        td {\n          border-bottom: 0;\n        }\n      }\n    }\n\n    th,\n    td {\n      margin: 0;\n      padding: 0.5rem;\n      border-bottom: 1px solid black;\n      border-right: 1px solid black;\n\n      :last-child {\n        border-right: 0;\n      }\n    }\n  }\n"])));function ee(e){var t=e.columns,a=e.data,o=e.onSelectionChange,n=Object(Q.useTable)({columns:t,data:a}),i=n.getTableProps,s=n.getTableBodyProps,r=n.headerGroups,l=n.rows,c=n.prepareRow;return Object(T.jsxs)("table",Object(z.a)(Object(z.a)({},i()),{},{children:[Object(T.jsx)("thead",{children:r.map((function(e){return Object(T.jsx)("tr",Object(z.a)(Object(z.a)({},e.getHeaderGroupProps()),{},{children:e.headers.map((function(e){return Object(T.jsx)("th",Object(z.a)(Object(z.a)({},e.getHeaderProps()),{},{children:e.render("Header")}))}))}))}))}),Object(T.jsx)("tbody",Object(z.a)(Object(z.a)({},s()),{},{children:l.map((function(e){return c(e),Object(T.jsx)("tr",Object(z.a)(Object(z.a)({},e.getRowProps()),{},{onClick:function(){return o(e.original)},children:e.cells.map((function(e){return Object(T.jsx)("td",Object(z.a)(Object(z.a)({},e.getCellProps()),{},{children:e.render("Cell")}))}))}))}))}))]}))}var te,ae,oe,ne=function(e){var t=e.value,a=e.trim;return Object(T.jsx)(T.Fragment,{children:t&&t.replace(a,"")})};function ie(e){var t=e.timeRange.minTime,a=e.timeRange.maxTime,o=e.logData.tripLogs.getLogs_(new Date(t),new Date(a)).value(),n=S.a.useMemo((function(){var t=[{Header:"Date",accessor:"formattedDate"},{Header:"SDK Version",accessor:"jsonPayload.request.header.sdkVersion"},{Header:"OS Version",accessor:"jsonPayload.request.header.osVersion"},{Header:"Method",accessor:"jsonPayload.@type",Cell:function(e){var t=e.cell.value;return Object(T.jsx)(ne,{value:t,trim:"type.googleapis.com/maps.fleetengine."})}},{Header:"Vehicle",accessor:"labels.vehicle_id"},{Header:"Trip",accessor:"labels.trip_id"},{Header:"Vehicle State",accessor:"jsonPayload.response.state",Cell:function(e){var t=e.cell.value;return Object(T.jsx)(ne,{value:t,trim:"VEHICLE_STATE_"})}},{Header:"Trip Status",accessor:"jsonPayload.response.status",Cell:function(e){var t=e.cell.value;return Object(T.jsx)(ne,{value:t,trim:"TRIP_STATUS_"})}},{Header:"Nav Status",accessor:"jsonPayload.response.navStatus",Cell:function(e){var t=e.cell.value;return Object(T.jsx)(ne,{value:t,trim:"NAVIGATION_STATUS_"})}}];return D.a.map(e.extraColumns,(function(e){var a=e.split(".");t.push({Header:a[a.length-1],accessor:e})})),[{Header:"Log Entries (click row to view full log entry)",columns:t}]}),[e.extraColumns]);return Object(T.jsx)($,{children:Object(T.jsx)(ee,{columns:n,data:o,onSelectionChange:e.onSelectionChange})})}var se=Z.a.button(te||(te=Object(X.a)([""]))),re=Object(Z.a)(se)(ae||(ae=Object(X.a)(["\n  opacity: 0.6;\n  ","\n"])),(function(e){return e.active&&"\n    opacity: 1;\n    color: Green;\n  "})),le="https://github.com/googlemaps/fleet-debugger/blob/main/docs/GPSAccuracy.md",ce="https://github.com/googlemaps/fleet-debugger/blob/main/docs/Heading.md",ue="https://github.com/googlemaps/fleet-debugger/blob/main/docs/Speed.md",ge="https://github.com/googlemaps/fleet-debugger/blob/main/docs/DwellTimes.md",de="https://github.com/googlemaps/fleet-debugger/blob/main/docs/VelocityJumps.md",he="https://github.com/googlemaps/fleet-debugger/blob/main/docs/MissingUpdates.md",pe=Z.a.div(oe||(oe=Object(X.a)(["\n  display: flex;\n"])));var me,fe,ve,we,ye,je=function(e){return Object(T.jsxs)(pe,{children:[Object(T.jsxs)(re,{active:e.showGPSBubbles,onClick:e.onClickGPSBubbles,children:["GPS Accuracy",Object(T.jsx)("a",{href:le,target:"_blank",rel:"noreferrer",children:"?"})]}),Object(T.jsxs)(re,{active:e.showHeading,onClick:e.onClickHeading,children:["Heading",Object(T.jsx)("a",{href:ce,target:"_blank",rel:"noreferrer",children:"?"})]}),Object(T.jsxs)(re,{active:e.showSpeed,onClick:e.onClickSpeed,children:["Speed",Object(T.jsx)("a",{href:ue,target:"_blank",rel:"noreferrer",children:"?"})]}),Object(T.jsxs)(re,{active:e.showDwellLocations,onClick:e.onClickDwellLocations,children:["Dwell Locations",Object(T.jsx)("a",{href:ge,target:"_blank",rel:"noreferrer",children:"?"})]}),Object(T.jsxs)(re,{active:e.showHighVelocityJumps,onClick:e.onClickHighVelocityJumps,children:["Jumps (unrealistic velocity)",Object(T.jsx)("a",{href:de,target:"_blank",rel:"noreferrer",children:"?"})]}),Object(T.jsxs)(re,{active:e.showMissingUpdates,onClick:e.onClickMissingUpdates,children:["Jumps (Temporal)",Object(T.jsx)("a",{href:he,target:"_blank",rel:"noreferrer",children:"?"})]}),Object(T.jsx)(re,{active:e.showClientServerTimeDeltas,onClick:e.onClickClientServerTimeDeltas,children:"Client/Server Time Deltas"}),Object(T.jsx)(re,{active:e.showTraffic,onClick:e.onClickTraffic,children:"Traffic"}),Object(T.jsx)(re,{active:e.showLiveJS,onClick:e.onClickLiveJS,children:"Start Live Journey Sharing for newest trip"})]})},be=function(e){Object(b.a)(a,e);var t=Object(O.a)(a);function a(e){var o;Object(y.a)(this,a),o=t.call(this,e);var n=new Date;return o.logData=e.logData,o.state={timeRange:{minTime:0,maxTime:n.setFullYear(n.getFullYear()+1)},featuredObject:{msg:"Click a table row to select object"},extraColumns:[],toggleOptions:{showGPSBubbles:!1,showHeading:!1,showSpeed:!1,showTraffic:!1,showDwellLocations:!1,showHighVelocityJumps:!1,showMissingUpdates:!1,showLiveJS:!1,showClientServerTimeDeltas:!1}},o.onSliderChangeDebounced=D.a.debounce((function(e){return o.onSliderChange(e)}),25),p=function(e){return o.setFeaturedObject(e)},m=function(e,t){return o.setTimeRange(e,t)},o}return Object(j.a)(a,[{key:"updateColumns",value:function(e,t){this.setState((function(a){var o=!a.toggleOptions[e];a.toggleOptions[e]=o,function(e,t){E[e](t)}(e,o);var n=D.a.clone(a.extraColumns);return D.a.forEach(t,(function(e){o?n.push(e):D.a.pull(n,e)})),a.extraColumns=n,a}))}},{key:"onClickGPSBubbles",value:function(){this.updateColumns("showGPSBubbles",["jsonPayload.request.vehicle.lastLocation.rawLocationAccuracy","jsonPayload.request.vehicle.lastLocation.locSensor"])}},{key:"onClickHeading",value:function(){this.updateColumns("showHeading",["jsonPayload.request.vehicle.lastLocation.heading","jsonPayload.request.vehicle.lastLocation.bearingAccuracy"])}},{key:"onClickSpeed",value:function(){this.updateColumns("showSpeed",["jsonPayload.request.vehicle.lastLocation.speed"])}},{key:"onClickTraffic",value:function(){this.updateColumns("showTraffic",[])}},{key:"onClickDwellLocations",value:function(){this.updateColumns("showDwellLocations",[])}},{key:"onClickHighVelocityJumps",value:function(){this.updateColumns("showHighVelocityJumps",["jsonPayload.request.vehicle.lastLocation.speed"])}},{key:"onClickMissingUpdates",value:function(){this.updateColumns("showMissingUpdates",["jsonPayload.temporal_gap"])}},{key:"onClickClientServerTimeDeltas",value:function(){this.updateColumns("showClientServerTimeDeltas",["jsonPayload.response.lastLocation.rawLocationTime","jsonPayload.response.lastLocation.serverTime"])}},{key:"onClickLiveJS",value:function(){this.updateColumns("showLiveJS",[])}},{key:"onSliderChange",value:function(e){this.setTimeRange(e.minTime,e.maxTime)}},{key:"onSelectionChange",value:function(e){!function(e){D.a.forEach(M,(function(e){return e.setMap(null)})),M=[];var t={path:"M10.453 14.016l6.563-6.609-1.406-1.406-5.156 5.203-2.063-2.109-1.406 1.406zM12 2.016q2.906 0 4.945 2.039t2.039 4.945q0 1.453-0.727 3.328t-1.758 3.516-2.039 3.070-1.711 2.273l-0.75 0.797q-0.281-0.328-0.75-0.867t-1.688-2.156-2.133-3.141-1.664-3.445-0.75-3.375q0-2.906 2.039-4.945t4.945-2.039z",fillColor:"blue",fillOpacity:.6,strokeWeight:0,rotation:0,scale:2,anchor:new google.maps.Point(15,30)},a=D.a.get(e,"jsonPayload.request.vehicle.lastLocation.rawLocation");if(a){var o=D.a.get(e,"jsonPayload.response.status"),n=D.a.get(e,"jsonPayload.response.state"),s=new window.google.maps.Marker({position:{lat:a.latitude,lng:a.longitude},map:i,icon:t,title:"Vehicle state "+n+" Trip Status "+o});M.push(s)}}(e),this.setFeaturedObject(e)}},{key:"setFeaturedObject",value:function(e){this.setState({featuredObject:e})}},{key:"setTimeRange",value:function(e,t){this.setState({timeRange:{minTime:e,maxTime:t}}),U(e,t)}},{key:"onDataframePropClick",value:function(e){this.setState((function(t){var a=D.a.join(e.namespace,".")+"."+e.name;return{extraColumns:D.a.find(t.extraColumns,(function(e){return e===a}))?D.a.without(t.extraColumns,a):[].concat(Object(w.a)(t.extraColumns),[a])}}))}},{key:"render",value:function(){var e=this;return Object(T.jsxs)("div",{children:[Object(T.jsx)(Y,{logData:this.logData,curMin:this.state.timeRange.minTime,curMax:this.state.timeRange.maxTime,onSliderChange:this.onSliderChangeDebounced}),Object(T.jsx)(je,{showGPSBubbles:this.state.toggleOptions.showGPSBubbles,onClickGPSBubbles:function(){return e.onClickGPSBubbles()},showSpeed:this.state.toggleOptions.showSpeed,onClickSpeed:function(){return e.onClickSpeed()},showHeading:this.state.toggleOptions.showHeading,onClickHeading:function(){return e.onClickHeading()},showTraffic:this.state.toggleOptions.showTraffic,onClickTraffic:function(){return e.onClickTraffic()},showDwellLocations:this.state.toggleOptions.showDwellLocations,onClickDwellLocations:function(){return e.onClickDwellLocations()},showHighVelocityJumps:this.state.toggleOptions.showHighVelocityJumps,onClickHighVelocityJumps:function(){return e.onClickHighVelocityJumps()},showMissingUpdates:this.state.toggleOptions.showMissingUpdates,onClickMissingUpdates:function(){return e.onClickMissingUpdates()},showLiveJS:this.state.toggleOptions.showLiveJS,onClickLiveJS:function(){return e.onClickLiveJS()},showClientServerTimeDeltas:this.state.toggleOptions.showClientServerTimeDeltas,onClickClientServerTimeDeltas:function(){return e.onClickClientServerTimeDeltas()}}),Object(T.jsxs)("div",{style:{width:"100%",marginTop:"20px"},children:[Object(T.jsx)("div",{style:{width:"65%",overflowX:"scroll",overFlowY:"scroll",height:"100%",float:"left"},children:Object(T.jsx)(ie,{logData:this.logData,style:{width:"100%"},timeRange:this.state.timeRange,extraColumns:this.state.extraColumns,onSelectionChange:function(t){return e.onSelectionChange(t)}})}),Object(T.jsx)("div",{style:{marginLeft:"65%",overFlowX:"scroll",overFlowY:"scroll",height:"100%"},children:Object(T.jsx)(q,{featuredObject:this.state.featuredObject,onClick:function(t){return e.onDataframePropClick(t)}})})]})]})}}]),a}(S.a.Component),Oe=a(19),Le=a.n(Oe),Se=a(51),ke=function(){function e(){Object(y.a)(this,e)}return Object(j.a)(e,null,[{key:"formatDuration",value:function(e){var t=e/1e3,a=Math.floor(t/3600),o=Math.floor((t-3600*a)/60),n=Math.floor(t-3600*a-60*o),i="";return a>0&&(i+=a+" hours "),o>0&&(i+=o+" minutes "),n>0&&(i+=n+" seconds"),i}}]),e}(),Ce=function(){function e(t,a,o){Object(y.a)(this,e),this.tripIdx=t,this.tripName=a,this.updateRequests=1,this.pathCoords=[],this.tripDuration=0,this.creationTime="Unknown",this.firstUpdate=o,this.lastUpdate="Unknown"}return Object(j.a)(e,[{key:"getTraveledDistance",value:function(){return window.google.maps.geometry.spherical.computeLength(this.pathCoords)}},{key:"getFeaturedData",value:function(){return{updateRequests:this.updateRequests,tripName:this.tripName,duration:ke.formatDuration(this.tripDuration),creationTime:this.creationTime,traveledDistanceKilometers:this.getTraveledDistance()/1e3,traveledDistanceMiles:this.getTraveledDistance()/1609,firstUpdate:this.firstUpdate,lastUpdate:this.lastUpdate}}},{key:"getPathCoords",value:function(e,t){return e&&t?D()(this.pathCoords).filter((function(a){return a.date>=e&&a.date<=t})).value():this.pathCoords}},{key:"appendCoords",value:function(e,t){this.pathCoords.push({lat:e.rawLocation.latitude,lng:e.rawLocation.longitude,trip_id:this.tripName,date:new Date(t)})}}]),e}(),De=function(){function e(){Object(y.a)(this,e)}return Object(j.a)(e,null,[{key:"median",value:function(e){if(1===e.length)return e[0];var t=Object(w.a)(e).sort(),a=Math.ceil(t.length/2),o=Math.floor(t.length/2);return a===o?t[o]:(t[a]+t[o])/2}}]),e}(),Te=0,xe=function(){function e(t,a,o){Object(y.a)(this,e);var n=D.a.get(a,"jsonPayload.request.vehicle.lastLocation"),i=D.a.get(o,"jsonPayload.request.vehicle.lastLocation"),s=new google.maps.LatLng({lat:n.rawLocation.latitude,lng:n.rawLocation.longitude}),r=new google.maps.LatLng({lat:i.rawLocation.latitude,lng:i.rawLocation.longitude}),l=window.google.maps.geometry.spherical.computeDistanceBetween(s,r),c=o.date-a.date,u=l/(c/1e3);this.entry=o,this.prevEntry=a,this.timeSpentMS=c,this.distanceTraveled=l,this.velocity=u,this.startLoc=s,this.startDate=a.date,this.endDate=o.date,this.endLoc=r,this.jumpIdx=t}return Object(j.a)(e,[{key:"getFeaturedData",value:function(){return{timeSpentMS:this.timeSpentMS,distanceTraveled:this.distanceTraveled,velocity:this.velocity,velocityMPH:2.237*this.velocity,startLoc:this.startLoc.toString(),startDate:this.prevEntry.date,endDate:this.entry.date,endLoc:this.endLoc.toString(),jumpIdx:this.jumpIdx,date:this.entry.date,computedOutlierVelocity:Te}}},{key:"getLogViewerEntry",value:function(){var e=this.getFeaturedData();return e.timestampMS=this.startDate.getTime(),e.formattedDate=this.startDate.toISOString(),e.jsonPayload={"@type":"Jump",request:{vehicle:{lastLocation:{speed:this.velocity}}}},e}}],[{key:"getSignificantJumps",value:function(e){if(!e)return[];var t=D.a.map(e,"velocity"),a=D.a.mean(t),o=De.median(t),n=D.a.min(t),i=D.a.max(t);return console.log("avgVelocity",a),console.log("medianVelocity",o),console.log("minVelocity",n),console.log("maxVelocity",i),Te=D.a.min([68,100*o]),D()(e).filter((function(e){return e.velocity>=Te})).sortBy("velocity").value()}}]),e}(),Pe=0,Me=function(){function e(t,a,o){Object(y.a)(this,e);var n=o.date-a.date,i=D.a.get(o,"jsonPayload.request.vehicle.lastLocation"),s=D.a.get(a,"jsonPayload.request.vehicle.lastLocation"),r=new google.maps.LatLng({lat:s.rawLocation.latitude,lng:s.rawLocation.longitude}),l=new google.maps.LatLng({lat:i.rawLocation.latitude,lng:i.rawLocation.longitude});this.entry=o,this.prevEntry=a,this.interval=n,this.startLoc=r,this.startDate=a.date,this.endDate=o.date,this.endLoc=l,this.idx=t,this.startVehicleState=D.a.get(o,"jsonPayload.response.state"),this.endVehicleState=D.a.get(a,"jsonPayload.response.state"),this.duration=ke.formatDuration(this.interval)}return Object(j.a)(e,[{key:"getFeaturedData",value:function(){return{duration:this.duration,interval:this.interval,startDate:this.startDate,startLoc:this.startLoc.toString(),endDate:this.endDate,endLoc:this.endLoc.toString(),startVehicleState:this.startVehicleState,endVehicleState:this.endVehicleState,computedOutlier:ke.formatDuration(Pe)}}},{key:"getStateTransition",value:function(){return this.startVehicleState.replace("VEHICLE_STATE_","")+">"+this.endVehicleState.replace("VEHICLE_STATE_","")}},{key:"getLogViewerEntry",value:function(){var e=this.getFeaturedData();return e.date=this.startDate,e.timestampMS=this.startDate.getTime(),e.formattedDate=this.startDate.toISOString(),e.jsonPayload={"@type":"Missing Updates",temporal_gap:e.duration,response:{state:this.getStateTransition()}},e}}],[{key:"getSignificantMissingUpdates",value:function(e){if(!e)return[];var t=D.a.map(e,"interval"),a=D.a.mean(t),o=De.median(t),n=D.a.min(t),i=D.a.max(t);return console.log("avgInternal",a),console.log("medianInternal",o),console.log("minInternal",n),console.log("maxInternal",i),console.log("updateOutlier",6e4),Pe=D.a.min([10*o,6e4]),console.log("computedOutlier",Pe),D()(e).filter((function(e){return e.interval>=Pe})).sortBy("interval").value()}}]),e}(),_e=function(){function e(t,a){Object(y.a)(this,e),this.solutionType=a,"LMFS"===this.solutionType?(this.updateVehicleSuffix="update_delivery_vehicle",this.lastLocationPath="jsonPayload.request.deliveryVehicle.lastLocation"):(this.updateVehicleSuffix="update_vehicle",this.vehicleName="vehicle",this.lastLocationPath="jsonPayload.request.vehicle.lastLocation"),this.trip_ids=[],this.trips=[],this.tripStatusChanges=[],this.rawLogs=D.a.reverse(t),this.processTripSegments(),this.minDate=new Date(t[0].timestamp),this.maxDate=new Date(D.a.last(t).timestamp),this.velocityJumps=[],this.missingUpdates=[],this.dwellLocations=[],D.a.map(this.rawLogs,(function(e,t){e.date=new Date(e.timestamp),e.formattedDate=e.date.toISOString(),e.timestampMS=e.date.getTime(),e.idx=t}))}return Object(j.a)(e,[{key:"getRawLogs_",value:function(e,t){return e=e||this.minDate,t=t||this.maxDate,D()(this.rawLogs).filter((function(a){return a.date>=e&&a.date<=t}))}},{key:"getLogs_",value:function(e,t){return this.getRawLogs_(e,t).concat(this.velocityJumps.map((function(e){return e.getLogViewerEntry()}))).concat(this.missingUpdates.map((function(e){return e.getLogViewerEntry()}))).filter((function(a){return a.date>=e&&a.date<=t})).sortBy("timestampMS")}},{key:"getTripStatusChanges",value:function(){return this.tripStatusChanges}},{key:"getTripStatusAtDate",value:function(e){var t=D.a.sortedIndexBy(this.tripStatusChanges,{date:e},"date");if(t>=1)return this.tripStatusChanges[t-1].newStatus}},{key:"getTripIDs",value:function(){return this.trip_ids}},{key:"getTrips",value:function(){return this.trips}},{key:"getMissingUpdates",value:function(e,t){var a,o=this,n=this.getRawLogs_(e,t).filter((function(e){return D.a.get(e,o.lastLocationPath+".rawLocation")})).map((function(e){var t;return a&&(t=new Me(e.idx,a,e)),a=e,t})).compact().value();return this.missingUpdates=Me.getSignificantMissingUpdates(n),this.missingUpdates}},{key:"getHighVelocityJumps",value:function(e,t){var a,o=this,n=this.getRawLogs_(e,t).filter((function(e){return D.a.get(e,o.lastLocationPath+".rawLocation")})).map((function(e){var t;return a&&(t=new xe(e.idx,a,e)),a=e,t})).compact().value();return this.velocityJumps=xe.getSignificantJumps(n),this.velocityJumps}},{key:"getDwellLocations",value:function(e,t){var a=this,o=[];return D.a.forEach(this.rawLogs,(function(n){var i=D.a.get(n,a.lastLocationPath);if(!(!i||!i.rawLocation||n.date<e||n.date>t)){var s={lat:i.rawLocation.latitude,lng:i.rawLocation.longitude},r=D.a.find(o,(function(e){return window.google.maps.geometry.spherical.computeDistanceBetween(e.leaderCoords,new google.maps.LatLng(s))<=20}));r?r.updates++:o.push({leaderCoords:new window.google.maps.LatLng(s),updates:1})}})),this.dwellLocations=D.a.filter(o,(function(e){return e.updates>=12})),this.dwellLocations}},{key:"getSegmentID",value:function(e){if("LMFS"===this.solutionType){var t=D.a.get(e,"jsonPayload.response.remainingVehicleJourneySegments");return t&&"Stops Left "+t.length}return D.a.get(e,"labels.trip_id")}},{key:"processTripSegments",value:function(){var e=this,t="this is not a segment",a=void 0,o=0,n=0,i="no status";D.a.forEach(this.rawLogs,(function(s){if(s.logName.match(e.updateVehicleSuffix)){var r=e.getSegmentID(s);if(r!==t)t=r,a=new Ce(o,r||"non-trip-segment-"+n,new Date(s.timestamp)),e.trips.push(a),e.trip_ids.push(a.tripName),o++,void 0===r&&n++;else a.lastUpdate=new Date(s.timestamp),a.tripDuration=a.lastUpdate-a.firstUpdate,a.updateRequests++;var l=D.a.get(s,e.lastLocationPath);l&&l.rawLocation&&a.appendCoords(l,s.timestamp)}var c=D.a.get(s,"jsonPayload.response.status");c&&c!==i&&(e.tripStatusChanges.push({newStatus:c,date:new Date(s.timestamp)}),i=c)}))}}]),e}();function Ee(){return(Ee=Object(Se.a)(Le.a.mark((function e(){var t,a;return Le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("./data.json");case 2:return t=e.sent,e.next=5,t.json();case 5:a=e.sent,me=a.jwt,fe=a.projectId,ve=a.APIKEY,we=a.solutionType,ye=new _e(a.rawLogs,we);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}(function(){return Ee.apply(this,arguments)})().then((function(){var e={tripLogs:ye,apikey:ve,jwt:me,projectId:fe,solutionType:we};v.a.render(Object(T.jsxs)("div",{children:[Object(T.jsx)(H,{logData:e}),Object(T.jsx)(be,{logData:e})]}),document.getElementById("root"))}))}},[[139,1,2]]]);
//# sourceMappingURL=main.b6fc3059.chunk.js.map